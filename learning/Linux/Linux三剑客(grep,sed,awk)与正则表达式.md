# 按行截取信息：grep
### 基本用法：`grep [-acinv] [--color=auto] 搜索字符串 文件名`

|选项与参数|说明|
|-|-|
|-a|将二进制(binary)文件以 text 文件的方式进行搜寻数据|
|-c|仅显示搜寻结果的行号|
|-i|忽略大小写|
|-n|显示行号|
|-v|反向选择，即只显示与关键字无关的内容|
|--color=auto|自动高亮找到的关键字|

例子：
1. 找到 last 中的非 reboot 用户：`last | grep -v reboot`
2. 找到 /etc/passwd 中的 nologin 用户：`grep nologin /etc/passwd`

### 进阶用法：`grep -[AB] 搜寻字符串 文件名`

|选项与参数|说明|
|-|-|
|-A|后面接数字，为 after 的意思。即除了显示该行外，还显示后面 n 行|
|-B|后面接数字，为 before 的意思。即除了显示该行外，还显示前面 n 行|

例子：
通过 dmesg 命令获取核心信息后，搜寻关键字为 x86 的并显示结果的前5行跟后5行：`dmesg | grep -B 5 -A 5 x86/fpu`

# 正则表达式(Regular Expression)
正则表达式就是处理字符串的方法，以行为单位来进行字符串的处理行为， 正则表达式透过一些特殊符号的辅助，可以让使用者轻易的达到搜寻/删除/取代某特定字符串的处理程序

正则表达式基本上是一种表达式，只要程序支持这种表达式，那么该程序就可以用来作为正则表达式的字符串处理之用，例如 vi, grep, awk ,sed 等程序

使用正则表达式时，需要特别留意当时环境的语系(locale)，否则可能会发现与别人不相同的结果

## 基础正则表达式(以 grep 为例)
一些用于正则表达式的特殊符号
|特殊符号|意义|
|-|-|
|[:alnum:]|代表英文大小写字符及数字，亦即 0-9, A-Z, a-z|
|[:alpha:]|代表任何英文大小写字符，亦即 A-Z, a-z|
|[:blank:]|代表空格键与 [Tab] 按键两者|
|[:cntrl:]|代表键盘上面的控制按键，亦即包括 CR, LF, Tab, Del..等等|
|[:digit:]|代表数字而已，亦即 0-9|
|[:graph:]|除了空格符 (空格键与 [Tab] 按键) 外的其他所有按键|
|[:lower:]|代表小写字符，亦即 a-z|
|[:print:]|代表任何可以被打印出来的字符|
|[:punct:]|代表标点符号 (punctuation symbol)，亦即：" ' ? ! ; : # $...|
|[:upper:]|代表大写字符，亦即 A-Z|
|[:space:]|任何会产生空白的字符，包括空格键, [Tab], CR 等等|
|[:xdigit:]|代表 16 进位的数字类型，因此包括： 0-9, A-F, a-f 的数字与字符|

### 基础正则表达式练习
练习前先注意，语系设置如下：
`LANG=C; export LC_ALL=C`

#### 一、特定字符串搜寻
1. 搜寻特定字符串 "the" ：`grep the 文件名`

2. 反向搜寻特定字符串 "the" ：`grep -v the 文件名`

3. 搜寻特定字符串 "the" 且忽略大小写功能：`grep -i the 文件名`

#### 二、利用[]对搜寻进行分类
1. 搜寻关键字 "test" 跟 "taste"：`grep t[ae]st 文件名` 
([] 里面无论有几个字符，匹配搜寻结果是仅匹配其中一个字符)

2. 搜寻字符中带有 "oo" 的字符：`grep oo 文件名`

3. 搜寻字符中带有 "oo" 的字符但是不能以 "g" 开头：`grep [^g]oo 文件名`

4. 搜寻字符中带有 "oo" 的字符但是不能以小写字母开头：`grep [^a-z]oo 文件名` 或 `grep [^[:lower:]]oo 文件名`([:lower:]=a-z)

5. 搜寻带有数字的行：`grep [0-9] 文件名` 或 `grep [[:digit:]] 文件名`([:digit:]=1-9)

#### 三、行首(^)与行尾($)匹配搜索
1. 搜寻以小写字母开头的数据：`grep ^[a-z] 文件名` 或 `grep ^[[:lower:]] 文件名`

2. 搜寻以非字母开头的数据：`grep ^[^a-zA-Z] 文件名` 或 `grep ^[^[:alpha:]] 文件名`(^在[]外指的是行首符，在[]内指的是非)

3. 搜寻以.结尾的数据：`grep \.$ 文件名`(只能搜索到 Linux 换位符的($)，不能搜索到 Windows 换位符的(^M$))

4. 搜寻空白行：`grep "^$" 文件名`(空白行指只有行首与行尾的，中间没有数据)

5. 搜索 /etc/man_db.conf 但去掉空行与 # 开头的数据：`grep -v "^#" /etc/man_db.conf | grep -v "^$"`

#### 四、匹配任意字符(.)与重复匹配前一个字符0到无穷次(*)
* .(小数点)：代表一定有一个任意字符的意思；
* *(星星号)：代表重复前一个字符，0到无穷多次的意思
* .*(点星)：代表匹配任何非换行字符
1. 搜寻关键字为 g??d 的数据：`grep "g..d" 文件名`

2. 搜寻字符中带有 "o" 、"oo"、"ooo"的数据：`grep "oo*" 文件名`、`grep "ooo*" 文件名`、`grep "oooo*" 文件名`(因为 * 指的是重复前一个字符，0到无穷多次的意思，所以匹配 "o" 的时候需要填写 "oo")

3. 搜寻以 "g" 开头和以 "g" 结尾的字符串：`grep "g.*g" 文件名`

4. 搜寻有数字的行：`grep "[1-9]." 文件名` 或 `grep "[1-9][1-9]*" 文件名` 或 `grep "[1-9]" 文件名`

#### 五、限定连续字符范围{}
* 需要找出连续字符串时，要使用到限定范围的字符 {}。因为 shell 中 {} 有别的意义，因此需要进行转义
1. 搜寻带有 "oo" 的数据：`grep -n "o\{2\}" 文件名`

2. 搜寻两个 "g" 中间带有二到五个 "o" 的数据：`grep -n "go\{2,5\}g" 文件名`

3. 搜寻两个 "g" 中间带有二到无穷个 "o" 的数据：`grep -n "go\{2,\}g" 文件名`

#### 基础正则表达式字符汇总
|RE字符|意义|范例|
|-|-|-|
|^word|搜寻以字符串(word)为行首的数据|搜寻行首为 # 开始的那一行，并列出行号：`grep -n '^#' 文件名`|
|word$|搜寻以字符串(word)为行尾的数据|将行尾为 ! 的那一行打印出来，并列出行号：`grep -n '!$' 文件名`|
|.|匹配任意字符|搜寻两个 e 中有且仅有一个字符(包括空格符)：`grep -n 'e.e' 文件名`|
|\\|转义字符，将特殊符号的特殊意义去除|搜寻含有单引号 ' 的那一行：`grep -n \' 文件名`|
|\*|重复匹配前一个 RE 字符零到无穷多次|找出含有es、ess、esss等等的字符串：`grep -n 'ess*' 文件名`|
|[list]|对搜寻进行分类，匹配单个数字或字符|搜寻含有 gl 或 gd 的那一行：`grep -n 'g[ld]' 文件名`|
|[n1-n2]|对搜寻进行分类，匹配单个连续数字或字符|搜寻含有任意数字的那一行：`grep -n '[0-9]' 文件名`|
|[^list]|反向选择|搜寻不是 oot 的数据：`grep -n 'oo[^t]' 文件名`|
|\{n,m\}|连续匹配前一个 RE 字符 n 到 m 次|搜寻两个 "g" 中间带有二到五个 "o" 的数据：`grep -n "go\{2,5\}g" 文件名`|
|\{n\}|连续匹配前一个 RE 字符 n 次|搜寻带有 "oo" 的数据：`grep -n "o\{2\}" 文件名`|
|\{n,\}|连续匹配前一个 RE 字符 n 次以上|搜寻两个 "g" 中间带有二到无穷个 "o" 的数据：`grep -n "go\{2,\}g" 文件名`|

## 延伸正则表达式
延伸正则表达式可以透过群组功能 | 来进行一次搜寻，管线意义为 or
延伸正则表达式用法：`egrep`

|RE字符|意义|范例|
|-|-|-|
|+|重复匹配前一个 RE 字符一次或一次以上|搜寻含有关键字 god、good、goood 的数据：`egrep -n 'go+d' 文件名`|
|?|匹配前一个 RE 字符零次或一次|搜寻含有关键字 gd 与 god 的数据：`egrep -n 'go?d' 文件名`|
|\||用或( or )的方式找出数个关键字|搜寻 gd 或 good 这两个字符串的数据：`egrep -n 'gd|good' 文件名`|
|()|找出括号中字符串|搜寻 glad 或 good 这两个字符串的数据：
egrep -n 'g(la|oo)d' regular_express.txt
()+
意义：多个重复群组的判别
范例：将『AxyzxyzxyzxyzC』用 echo 叫出，然后再使用如下的方法搜寻一下！
echo 'AxyzxyzxyzxyzC' | egrep 'A(xyz)+C'
上面的例子意思是说，我要找开头是 A 结尾是 C ，中间有一个以上的 "xyz" 字符串的意思～


# sed 工具
sed 可以将数据进行取代、删除、新增、截取特定行等等的功能

用法：`sed [-nefr]'动作'`

参数解析：
|选项与参数|解析|
|-|-|
|-n|使用安静(silent)模式。在一般 sed 的用法中，所有来自 STDIN 的数据一般都会被列出到屏幕上。但如果加上 -n 参数后，只显示经过 sed 特殊处理的那一行|
|-e|直接在指令模式上进行 sed 的动作编辑，但是一般不同添加|
|-f|直接将 sed 的动作写在一个文件内，-f filename 则可以执行 filename 内的 sed 动作|
|-r|使 sed 的动作支持延伸型正则表达式(预设是基础正则表达式)|
|-i|直接修改读取的文件内容，而不是由屏幕输出|

动作解析：
动作格式为：'[n1,n2]function'
|动作|解析|
|-|-|
|n1,n2|不一定存在，一般代表选择进行动作的行数，如需要在 10 到 20 行之间进行动作，则 10,20function|

function 有如下的参数：
|动作|解析|
|-|-|
|a|新增，接字符串，这些字符串会在新的一行出现(目前的下一行)|
|c|取代，接字符串，这些字符串可以取代 n1,n2 之间的行|
|d|删除，通常不接任何东西|
|i|插入，接字符串，这些字符串会在新的一行出现(目前的上一行)|
|p|打印，将某个选择的数据打印出。通常 p 会与参数 sed -n 一起运作|
|s|取代，可以直接进行取代的工作，通常可以搭配正规表示法，如替换1到20行数据：1,20s/old/new/g|

#### 一、以行为单位新增/删除功能
1. 删除 /etc/passwd 文件的2到5行：`nl /etc/passwd | sed '2,5d'`(如果要删除到行尾用 $ 符号替代，行首用 ^ 符号替代)
![sed1.png](https://i.loli.net/2021/01/16/XeAzYQKI29LsMqn.png)

2. 在 /etc/passwd 文件的第二行后加上 'test' 字样：`nl /etc/passwd | sed '2a test'`
![sed2.png](https://i.loli.net/2021/01/16/UXLT29ltnY8GWoQ.png)

3. 在 /etc/passwd 文件的第二行前加上 'test' 字样：`nl /etc/passwd | sed '2i test'`
![sed3.png](https://i.loli.net/2021/01/16/AtVcjL8vx3yNgQS.png)

4. 在 /etc/passwd 文件的第二行后加上 'test' 与 'test2' 字样：`nl /etc/passwd | sed '2a test \test2'`
![sed4.png](https://i.loli.net/2021/01/16/CUsiZEPAumfoycz.png)

#### 二、以行为单位的取代与显示功能
1. 将 /etc/passwd 中2-7行的数据取代为hahahahahahaha：`nl /etc/passwd | sed '2,7c hahahahahahaha'`
![sed1.png](https://i.loli.net/2021/01/17/AUdkEFVzovRq6Zs.png)

2. 只显示 /etc/passwd 中的2-7行：`nl /etc/passwd |sed -n '2,7p'`
![sed2.png](https://i.loli.net/2021/01/17/1u6LCZGiNzWsTRD.png)

#### 三、部分数据的搜寻与取代功能
sed 以行为单位进行部分数据的搜寻并取代的格式：`sed 's/旧数据内容/新数据内容/g'`

1. 找出 ifconfig 中的 ip 地址：
![图像 3.png](https://i.loli.net/2021/01/17/Ru8nW3Yo1MwDXcp.png)

2. 找出 man_db.conf 中带有关键字为 "MAN" 的且不为空和注释的数据：
![图像 4.png](https://i.loli.net/2021/01/17/5KyN2elmvBPA6Jf.png)

#### 四、直接修改文件内容(!!!)
sed 直接修改文件的内容格式：`sed -i '动作' 文件名`

1. 将文件中的 . 换为 ！：`sed -i 's/\./\!/g' 文件名`

2. 在文件中最后一行添加 hahahahaha ：`sed -i '$a hahahahaha' 文件名` 或 `sed '$a hahahahaha' 文件名`