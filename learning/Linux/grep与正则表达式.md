# 按行截取信息：grep
### 基本用法：`grep [-acinv] [--color=auto] 搜索字符串 文件名`

|选项与参数|说明|
|-|-|
|-a|将二进制(binary)文件以 text 文件的方式进行搜寻数据|
|-c|仅显示搜寻结果的行号|
|-i|忽略大小写|
|-n|显示行号|
|-v|反向选择，即只显示与关键字无关的内容|
|--color=auto|自动高亮找到的关键字|

例子：
1. 找到 last 中的非 reboot 用户：`last | grep -v reboot`
2. 找到 /etc/passwd 中的 nologin 用户：`grep nologin /etc/passwd`

### 进阶用法：`grep -[AB] 搜寻字符串 文件名`

|选项与参数|说明|
|-|-|
|-A|后面接数字，为 after 的意思。即除了显示该行外，还显示后面 n 行|
|-B|后面接数字，为 before 的意思。即除了显示该行外，还显示前面 n 行|

例子：
通过 dmesg 命令获取核心信息后，搜寻关键字为 x86 的并显示结果的前5行跟后5行：`dmesg | grep -B 5 -A 5 x86/fpu`

# 正则表达式(Regular Expression)
正则表达式就是处理字符串的方法，以行为单位来进行字符串的处理行为， 正则表达式透过一些特殊符号的辅助，可以让使用者轻易的达到搜寻/删除/取代某特定字符串的处理程序

正则表达式基本上是一种表达式，只要程序支持这种表达式，那么该程序就可以用来作为正则表达式的字符串处理之用，例如 vi, grep, awk ,sed 等程序

使用正则表达式时，需要特别留意当时环境的语系(locale)，否则可能会发现与别人不相同的结果

## 基础正则表达式(以 grep 为例)
一些用于正则表达式的特殊符号
|特殊符号|意义|
|-|-|
|[:alnum:]|代表英文大小写字符及数字，亦即 0-9, A-Z, a-z|
|[:alpha:]|代表任何英文大小写字符，亦即 A-Z, a-z|
|[:blank:]|代表空格键与 [Tab] 按键两者|
|[:cntrl:]|代表键盘上面的控制按键，亦即包括 CR, LF, Tab, Del..等等|
|[:digit:]|代表数字而已，亦即 0-9|
|[:graph:]|除了空格符 (空格键与 [Tab] 按键) 外的其他所有按键|
|[:lower:]|代表小写字符，亦即 a-z|
|[:print:]|代表任何可以被打印出来的字符|
|[:punct:]|代表标点符号 (punctuation symbol)，亦即：" ' ? ! ; : # $...|
|[:upper:]|代表大写字符，亦即 A-Z|
|[:space:]|任何会产生空白的字符，包括空格键, [Tab], CR 等等|
|[:xdigit:]|代表 16 进位的数字类型，因此包括： 0-9, A-F, a-f 的数字与字符|

### 基础正则表达式练习
练习前先注意，语系设置如下：
`LANG=C; export LC_ALL=C`

#### 一、特定字符串搜寻
1. 搜寻特定字符串 "the" ：`grep the 文件名`

2. 反向搜寻特定字符串 "the" ：`grep -v the 文件名`

3. 搜寻特定字符串 "the" 且忽略大小写功能：`grep -i the 文件名`

#### 二、利用[]对搜寻进行分类
1. 搜寻关键字 "test" 跟 "taste"：`grep t[ae]st 文件名` 
([] 里面无论有几个字符，匹配搜寻结果是仅匹配其中一个字符)

2. 搜寻字符中带有 "oo" 的字符：`grep oo 文件名`

3. 搜寻字符中带有 "oo" 的字符但是不能以 "g" 开头：`grep [^g]oo 文件名`

4. 搜寻字符中带有 "oo" 的字符但是不能以小写字母开头：`grep [^a-z]oo 文件名` 或 `grep [^[:lower:]]oo 文件名`([:lower:]=a-z)

5. 搜寻带有数字的行：`grep [0-9] 文件名` 或 `grep [[:digit:]] 文件名`([:digit:]=1-9)

#### 三、行首(^)与行尾($)匹配搜索
1. 搜寻以小写字母开头的数据：`grep ^[a-z] 文件名` 或 `grep ^[[:lower:]] 文件名`

2. 搜寻以非字母开头的数据：`grep ^[^a-zA-Z] 文件名` 或 `grep ^[^[:alpha:]] 文件名`(^在[]外指的是行首符，在[]内指的是非)

3. 搜寻以.结尾的数据：`grep \.$ 文件名`(只能搜索到 Linux 换位符的($)，不能搜索到 Windows 换位符的(^M$))

4. 搜寻空白行：`grep "^$" 文件名`(空白行指只有行首与行尾的，中间没有数据)

5. 搜索 /etc/man_db.conf 但去掉空行与 # 开头的数据：`grep -v "^#" /etc/man_db.conf | grep -v "^$"`

#### 四、匹配任意字符(.)与重复匹配前一个字符0到无穷次(*)
* .(小数点)：代表一定有一个任意字符的意思；
* *(星星号)：代表重复前一个字符，0到无穷多次的意思
* .*(点星)：代表匹配任何非换行字符
1. 搜寻关键字为 g??d 的数据：`grep "g..d" 文件名`

2. 搜寻字符中带有 "o" 、"oo"、"ooo"的数据：`grep "oo*" 文件名`、`grep "ooo*" 文件名`、`grep "oooo*" 文件名`(因为 * 指的是重复前一个字符，0到无穷多次的意思，所以匹配 "o" 的时候需要填写 "oo")

3. 搜寻以 "g" 开头和以 "g" 结尾的字符串：`grep "g.*g" 文件名`

4. 搜寻有数字的行：`grep "[1-9]." 文件名` 或 `grep "[1-9][1-9]*" 文件名` 或 `grep "[1-9]" 文件名`

#### 五、限定连续字符范围{}
* 需要找出连续字符串时，要使用到限定范围的字符 {}。因为 shell 中 {} 有别的意义，因此需要进行转义
1. 搜寻带有 "oo" 的数据：`grep -n "o\{2\}" 文件名`

2. 搜寻两个 "g" 中间带有二到五个 "o" 的数据：`grep -n "go\{2,5\}g" 文件名`

3. 搜寻两个 "g" 中间带有二到无穷个 "o" 的数据：`grep -n "go\{2,\}g" 文件名`

#### 基础正则表达式字符汇总
|RE字符|意义|范例|
|-|-|-|
|^word|搜寻以字符串(word)为行首的数据|搜寻行首为 # 开始的那一行，并列出行号：`grep -n '^#' regular_express.txt`|
|word$|搜寻以字符串(word)为行尾的数据|将行尾为 ! 的那一行打印出来，并列出行号：`grep -n '!$' regular_express.txt`|
|.|匹配任意字符|搜寻两个 e 中有且仅有一个字符(包括空格符)：`grep -n 'e.e' regular_express.txt`|
|\\|转义字符，将特殊符号的特殊意义去除|搜寻含有单引号 ' 的那一行！grep -n \' regular_express.txt|
|\*|重复匹配前一个 RE 字符零到无穷多次|找出含有es、ess、esss等等的字符串：`grep -n 'ess*' regular_express.txt`|
|[list]|对搜寻进行分类，匹配单个数字或字符|搜寻含有 gl 或 gd 的那一行：`grep -n 'g[ld]' regular_express.txt`|
|[n1-n2]|对搜寻进行分类，匹配单个连续数字或字符|搜寻含有任意数字的那一行：`grep -n '[0-9]' regular_express.txt`|
|[^list]|反向选择|搜寻不是 oot 的数据：`grep -n 'oo[^t]' regular_express.txt`|
|\{n,m\}|连续 n 到 m 个的『前一个 RE 字符』|
意义：若为 \{n\} 则是连续 n 个的前一个 RE 字符，
意义：若是 \{n,\} 则是连续 n 个以上的前一个 RE 字符！ 范例：在 g 与 g 之间有 2 个到
3 个的 o 存在的字符串，亦即 (goog)(gooog)
grep -n 'go\{2,3\}g' regular_express.txt
